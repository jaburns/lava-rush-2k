<canvas id=a width=320 height=200></canvas><h1 id=s></h1><style onload="g=a.getContext('webgl');for(f in g)g[f[0]+f[7]+[f[13]]]=g[f];h=g.cr(),r='attribute vec4 a;void main(){gl_Position=a;}',t=g.ch(35633),g.so(t,r),g.cS(t),g.ah(h,t),r='precision highp float;uniform vec4 g[2];int v;mat2 n(float v){return mat2(cos(v),sin(v),-sin(v),cos(v));}float f(vec2 v){return fract(sin(dot(v,vec2(12.9,4.1)))*43.5);}vec3 s(vec3 v){return abs(v-floor(v)-.5);}float r(vec3 v){float f=dot(s(v*.15+s(v.yzx*.075)),vec3(.444));v=v*1.5773-f;v.yz=vec2(v.y+v.z,v.z-v.y)*.866;v.xz=vec2(v.x+v.z,v.z-v.x)*.866;f+=dot(s(v*.225+s(v.yzx*.1125)),vec3(.222));return abs(f-.5)*1.9+(1.-abs(sin(f*9.)))*.05;}vec4 m(vec3 m){vec4 i=vec4(200);for(float x=-1.;x<=1.;x++){for(float y=-1.;y<=1.;y++){vec2 z=vec2(x,y)+floor((m.xz+10.)/20.);vec3 s,d=m-vec3(z.x,-5.,z.y)*20.;d.xz*=n(6.3*f(vec2(f(z),4)));s=abs(d)-vec3(5.+8.*f(vec2(f(z),1)),min(400.,z.y<-1.?0.:v!=1?100.+20.*f(vec2(f(z),2))+5.*z.y:m.y>20.*f(vec2(f(z),2))+5.*z.y?0.:1000.),5.+8.*f(vec2(f(z),3)));d=floor(d);vec4 a=vec4(.45+.51*(clamp(abs(mod(fract(f(vec2(f(z),5)))*6.+vec3(0,4,2),6.)-3.)-1.,0.,1.)-.5),length(max(s,0.))+min(max(s.x,max(s.y,s.z)),0.));i=a.w<i.w?a:i;}}if(v==0){float z=r(m);i.w-=z;i.xyz-=z;i.xyz+=pow(1.-z,3.)*vec3(1,.25,.1)*(.75+.25*sin(g[0].z));}return i;}vec3 t(vec3 v){vec2 z=vec2(.001,0);return normalize(vec3(m(v+z.xyy).w-m(v-z.xyy).w,m(v+z.yxy).w-m(v-z.yxy).w,m(v+z.yyx).w-m(v-z.yyx).w));}vec2 x(float v){return v=(v+1.)/2.,vec2(floor(v*255.)/255.,fract(v*255.));}void main(){if(g[0].w>0.){gl_FragColor=vec4(mix(3.*vec3(1,.25,.1),vec3(0),g[0].w/60.),1);return;}float f;vec4 z;vec2 s=(gl_FragCoord.xy-.5*vec2(320,200))/200.;vec3 i=g[1].xyz,d=vec3(0,-1,0);v=2;f=0.;z=vec4(0);for(int y=0;y<99;++y){z=m(i);if(z.w<.001||f>200.)break;f+=z.w*.8;i+=d*z.w*.8;}float y=f;i=g[1].xyz;d=normalize(vec3(s,1));v=1;vec3 a=vec3(0),c=i;float w=m(i-vec3(0,2,0)).w;if(y<3.)a.y=3.-y;if(w<2.)a.xz=(2.-w)*t(i-vec3(0,2,0)).xz;v=0;if(gl_FragCoord.x<=2.&&gl_FragCoord.y<1.){gl_FragColor=gl_FragCoord.x<1.?vec4(x(a.x),x(a.y)):vec4(x(a.z),y<3.?1:0,0);return;}i+=a;i.y+=.1*(sin(i.x)+sin(i.z));d.yz*=n(g[0].y);d.xz*=n(g[0].x);f=0.;z=vec4(0);for(int e=0;e<99;++e){z=m(i);if(z.w<.001||f>200.)break;f+=z.w*.8;i+=d*z.w*.8;}vec3 e=vec3(0),k;float l,b,p=-(c.y-g[0].z)/d.y;if(p>0.&&(p<f||f>200.))b=2.-r(c+p*d),k=vec3(1),l=0.,f=p;else if(f<200.){b=2.*clamp(1.-.1*(i.y-g[0].z),0.,1.);b*=b;k=z.xyz;vec3 o=g[1].xyz-i;l=.4+.6*dot(normalize(o),t(i))/pow(.8+.005*length(o),2.);}e=k*b*3.*vec3(1,.25,.1)+k*l;e=mix(vec3(0),e,exp(-f/40.));e=mix(e,vec3(0),-g[0].w/30.);gl_FragColor=vec4(e,1);}',t=g.ch(35632),g.so(t,r),g.cS(t),g.ah(h,t),g.vto(g.lg(h),2,5120,g.eet(g.ur(h)),g.bf(r=34962,g.cu()),g.ba(r,Uint8Array.of(1,1,1,128,128,1),r+82)),A=r=>(b=[0,0,0,-30,0,40,0,0],c=new Uint8Array(8),o=p=q=m=n=i=f=0,k={}),d=.003,a.onclick=r=>(a.requestPointerLock(),a.onmousemove=a.onmousemove||(r=>b[3]==0&&(b[0]+=d*r.movementX,b[1]-=d*r.movementY))),document.onkeydown=r=>(r.keyCode>48&&r.keyCode<58&&(d=.0005*(r.keyCode-48)),k[r.keyCode]=1),document.onkeyup=r=>k[r.keyCode]=0,e=r=>(c[r]/255+c[r+1]/255/255)*2-1,l=r=>(b[3]>180&&A(),p-=.02,b[5]+=p,o=q=0,k[87]&&(o+=Math.sin(b[0]),q+=Math.cos(b[0])),k[83]&&(o-=Math.sin(b[0]),q-=Math.cos(b[0])),k[68]&&(o+=Math.cos(b[0]),q-=Math.sin(b[0])),k[65]&&(o-=Math.cos(b[0]),q+=Math.sin(b[0])),k[32]&&f&&(b[5]+=(p=.5),f=0),o&&q&&(o/=Math.sqrt(q*q+o*o),q/=Math.sqrt(q*q+o*o)),m+=(o-m)/5,n+=(q-n)/5,b[4]+=.4*m,b[6]+=.4*n,b[2]+=.05,(b[5]<b[2]+1||b[3]<0)&&b[3]++||(s.innerText=(i=b[5]>i?b[5]|0:i)),g.re(g.da(4,g.uniform4fv(g.goa(h,'g'),b),3),0,2,1,6408,5121,c),b[4]+=e(0),b[5]+=e(2),b[6]+=e(4),c[6]&&(p=0,f=1),requestAnimationFrame(l)),A(),l()">html,body,canvas{margin:0;font-family:monospace;width:960px;height:600px;image-rendering:pixelated;image-rendering:crisp-edges;}h1{color:#fff;position:absolute;left:20px;top:0