<canvas id=a width=320 height=200></canvas><h1 id=s></h1><style onload="g=a.getContext('webgl');for(f in g)g[f[0]+f[7]+[f[13]]]=g[f];l=g.cr(),v='attribute vec4 a;void main(){gl_Position=a;}',w=g.ch(35633),g.so(w,v),g.cS(w),g.ah(l,w),v='precision highp float;uniform vec4 g[2];int v;mat2 f(float v){return mat2(cos(v),sin(v),-sin(v),cos(v));}float n(vec2 v){return fract(sin(dot(v,vec2(12.9,4.1)))*43.5);}float f(vec3 v,vec3 m,vec3 f,float y){vec3 n=v-m,z=f-m;float r=clamp(dot(n,z)/dot(z,z),0.,1.);return length(n-z*r)-y;}vec4 m(vec3 m){vec4 r=vec4(200);for(float i=-1.;i<=1.;i++){for(float y=-1.;y<=1.;y++){vec2 z=vec2(i,y)+floor((m.xz+10.)/20.);vec3 d,x=m-vec3(z.x,-5.,z.y)*20.;x.xz*=f(6.3*n(vec2(n(z),4)));d=abs(x)-vec3(5.+8.*n(vec2(n(z),1)),z.y<-1.?0.:v==0?100.+20.*n(vec2(n(z),2))+5.*z.y:m.y>20.*n(vec2(n(z),2))+5.*z.y?0.:1000.,5.+8.*n(vec2(n(z),3)));x=floor(x);vec4 t=vec4((1.-.3*mod(x.x+x.y+x.z,2.))*(.45+.51*(clamp(abs(mod(fract(n(vec2(n(z),5)))*6.+vec3(0,4,2),6.)-3.)-1.,0.,1.)-.5)),length(max(d,0.))+min(max(d.x,max(d.y,d.z)),0.));r=t.w<r.w?t:r;}}return r;}vec3 r(vec3 v){vec2 r=vec2(.001,0);return normalize(vec3(m(v+r.xyy).w-m(v-r.xyy).w,m(v+r.yxy).w-m(v-r.yxy).w,m(v+r.yyx).w-m(v-r.yyx).w));}vec2 t(float v){return v=(v+1.)/2.,vec2(floor(v*255.)/255.,fract(v*255.));}void main(){if(g[0].w>0.){gl_FragColor=vec4(mix(3.*vec3(1,.25,.1),vec3(0),g[0].w/60.),1);return;}float z;vec4 n;vec2 d=(gl_FragCoord.xy-.5*vec2(320,200))/200.;vec3 y=g[1].xyz,i=vec3(0,-1,0);v=0;z=0.;n=vec4(0);for(int x=0;x<99;++x){n=m(y);if(n.w<.001||z>200.)break;z+=n.w*.9;y+=i*n.w*.9;}float x=z;y=g[1].xyz;i=normalize(vec3(d,1));v=1;vec3 c=vec3(0),s=y;float w=m(y-vec3(0,2,0)).w;if(x<3.)c.y=3.-x;if(w<2.)c.xz=(2.-w)*r(y-vec3(0,2,0)).xz;v=0;if(gl_FragCoord.x<=2.&&gl_FragCoord.y<1.){gl_FragColor=gl_FragCoord.x<1.?vec4(t(c.x),t(c.y)):vec4(t(c.z),x<3.?1:0,0);return;}y+=c;y.y+=.1*(sin(y.x)+sin(y.z));i.yz*=f(g[0].y);i.xz*=f(g[0].x);z=0.;n=vec4(0);for(int e=0;e<99;++e){n=m(y);if(n.w<.001||z>200.)break;z+=n.w*.9;y+=i*n.w*.9;}vec3 e=vec3(0),k;float l,b,a=-(s.y-g[0].z)/i.y;if(a>0.&&(a<z||z>200.))b=2.,k=vec3(1),l=0.,z=a;else if(z<200.){b=2.*clamp(1.-.1*(y.y-g[0].z),0.,1.);b*=b;k=n.xyz;vec3 o=g[1].xyz-y;l=.3+.7*dot(normalize(o),r(y))/pow(.8+.005*length(o),2.);}e=k*b*3.*vec3(1,.25,.1)+k*l;e=mix(vec3(0),e,exp(-z/40.));gl_FragColor=vec4(e,1);}',w=g.ch(35632),g.so(w,v),g.cS(w),g.ah(l,w),g.vto(g.lg(l),2,5120,g.eet(g.ur(l)),g.bf(v=34962,g.cu()),g.ba(v,Uint8Array.of(1,1,1,128,128,1),v+82)),m=v=>(c=[0,0,0,0,0,40,0,0],d=new Uint8Array(8),f=-30,r=t=u=p=q=A=k=h=0,n={}),e=.003,a.onclick=v=>(a.requestPointerLock(),a.onclick=0,a.onmousemove=v=>f==0&&(k+=e*v.movementX,h-=e*v.movementY)),i=v=>(d[v]/255+d[v+1]/255/255)*2-1,b=v=>v>48&&v<58&&(e=.0005*(v-48)),document.onkeydown=v=>(n[v.keyCode]=1,b(v.keyCode)),document.onkeyup=v=>n[v.keyCode]=0,o=v=>(f>180&&m(),t-=.02,c[5]+=t,r=u=0,n[87]&&(r+=Math.sin(k),u+=Math.cos(k)),n[83]&&(r-=Math.sin(k),u-=Math.cos(k)),n[68]&&(r+=Math.cos(k),u-=Math.sin(k)),n[65]&&(r-=Math.cos(k),u+=Math.sin(k)),n[32]&&A&&(c[5]+=(t=.5),A=0),r&&u&&(r/=Math.sqrt(u*u+r*r),u/=Math.sqrt(u*u+r*r)),p+=(r-p)/5,q+=(u-q)/5,c[4]+=.4*p,c[6]+=.4*q,c[0]=k,c[1]=h,c[2]+=0.05,c[5]<c[2]+1&&f++||(s.innerText=c[5]|0),f<0&&f++,c[3]=f,g.re(g.da(4,g.uniform4fv(g.goa(l,'g'),c),3),0,2,1,6408,g.UNSIGNED_BYTE,d),c[4]+=i(0),c[5]+=i(2),c[6]+=i(4),d[6]&&(t=0,A=1),requestAnimationFrame(o)),m(),o()">html,body,canvas{margin:0;font-family:monospace;width:960px;height:600px;image-rendering:pixelated;image-rendering:crisp-edges;}h1{color:#fff;position:absolute;left:20px;top:0