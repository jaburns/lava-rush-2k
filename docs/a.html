<canvas id=a width=1024 height=768></canvas><style onload="g=a.getContext('webgl');for(i in g)g[i[0]+i[7]+[i[13]]]=g[i];h=g.cr(),o='attribute vec4 a;void main(){gl_Position=a;}',p=g.ch(35633),g.so(p,o),g.cS(p),g.ah(h,p),o='precision highp float;uniform vec4 g[2];mat2 n(float v){float y=cos(v),r=sin(v);return mat2(y,r,-r,y);}float n(vec3 v,vec3 y){vec3 r=abs(v)-y;return length(max(r,0.))+min(max(r.x,max(r.y,r.z)),0.);}float r(vec3 v){float y=20.;vec3 r=mod(v+.5*y,y)-.5*y;r.y=v.y;float m=3.*(floor((v.x+10.)/20.)+floor((v.z+10.)/20.));return n(r+vec3(0,m,0),vec3(5,1,5));}float v(vec3 v){return r(v);}vec3 f(vec3 y){vec2 r=vec2(.001,0);return normalize(vec3(v(y+r.xyy)-v(y-r.xyy),v(y+r.yxy)-v(y-r.yxy),v(y+r.yyx)-v(y-r.yyx)));}vec3 m(vec3 v){return v/=5.3,v=mod(floor(v),2.),v.x==v.z?vec3(1):vec3(.4);}void main(){vec2 r=(gl_FragCoord.xy-.5*vec2(1024,768))/768.;vec3 y=g[1].xyz,i=normalize(vec3(r,1));y.y+=.2*(sin(y.x)+sin(y.z));i.yz*=n(g[0].y);i.xz*=n(g[0].x);float x=0.,z=0.;vec3 l=y;for(int s=0;s<199;++s){z=v(y);if(z<.001||x>200.)break;x+=z*.5;y+=i*z*.5;}vec3 s=vec3(0);if(z<.01)s=m(y),s*=exp(-x/50.);if(gl_FragCoord.x<1.&&gl_FragCoord.y<1.){float k=v(l+vec3(0,-2,0));vec3 d=f(l+vec3(0,-2,0));if(k<0.&&d.y>.99){vec3 e=d*k;gl_FragColor=vec4(-e.y,0,0,1);}else gl_FragColor=vec4(0);}else gl_FragColor=vec4(s,1);}',p=g.ch(35632),g.so(p,o),g.cS(p),g.ah(h,p),console.log(g.geL(p)),g.vto(g.lg(h),2,5120,g.eet(g.ur(h)),g.bf(o=34962,g.cu()),g.ba(o,Uint8Array.of(1,1,1,128,128,1),o+82)),b=[0,0,0,0,0,0,0,0],c=new Uint8Array(16),k=10,l=e=m=n=f=d=0,i={},a.onclick=o=>(a.requestPointerLock(),a.onclick=0,a.onmousemove=o=>(f+=.003*o.movementX,d-=.003*o.movementY)),document.onkeydown=o=>i[o.keyCode]=1,document.onkeyup=o=>i[o.keyCode]=0,A=o=>(l-=.02,k+=l,i[87]&&(m+=.4*Math.sin(f),n+=.4*Math.cos(f)),i[83]&&(m-=.4*Math.sin(f),n-=.4*Math.cos(f)),i[68]&&(m+=.4*Math.sin(f+Math.PI/2),n+=.4*Math.cos(f+Math.PI/2)),i[65]&&(m+=.4*Math.sin(f-Math.PI/2),n+=.4*Math.cos(f-Math.PI/2)),i[32]&&e&&(k+=(l=.5),e=0),b[0]=f,b[1]=d,b[4]=m,b[5]=k,b[6]=n,g.re(g.da(4,g.uniform4fv(g.goa(h,'g'),b),3),0,1,1,6408,g.UNSIGNED_BYTE,c),c[3]&&(k+=c[0]/255,l=0,e=1),requestAnimationFrame(A)),A()">html,body{margin:0