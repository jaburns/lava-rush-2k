<canvas id=a width=1024 height=768></canvas><style onload="g=a.getContext('webgl');for(i in g)g[i[0]+i[7]+[i[13]]]=g[i];h=g.cr(),o='attribute vec4 a;void main(){gl_Position=a;}',p=g.ch(35633),g.so(p,o),g.cS(p),g.ah(h,p),o='precision highp float;uniform vec4 g[2];float v(vec2 v){return fract(sin(v.x+1000.*v.y)*43758.5);}float n(vec2 m){float f,r=0.;vec2 y=ceil(m/=30.);m.x*=f=sign(v(y)-.5);f*=2.*mod(y.x+y.y,2.)-1.;r-=f*smoothstep(.4,.6,length(m=fract(m)))*smoothstep(.4,.6,length(1.-m))+.5-.5*f+r++;return r;}mat2 f(float v){float m=cos(v),r=sin(v);return mat2(m,r,-r,m);}float f(vec3 v,vec3 m){vec3 r=abs(v)-m;return length(max(r,0.))+min(max(r.x,max(r.y,r.z)),0.);}float x(vec3 v){float m=20.;vec3 r=mod(v+.5*m,m)-.5*m;r.y=v.y;float y=0.;return f(r+vec3(0,y,0),vec3(5,1,5));}float m(vec3 v){return v.y+4.+2.*n(v.xz);}vec3 s(vec3 v){vec2 r=vec2(.001,0);return normalize(vec3(m(v+r.xyy)-m(v-r.xyy),m(v+r.yxy)-m(v-r.yxy),m(v+r.yyx)-m(v-r.yyx)));}vec3 l(vec3 v){return v/=5.3,v=mod(floor(v),2.),v.x==v.z?vec3(1):vec3(.4);}void main(){vec2 v=(gl_FragCoord.xy-.5*vec2(1024,768))/768.;vec3 r=g[1].xyz,y=normalize(vec3(v,1));r.y+=.2*(sin(r.x)+sin(r.z));y.yz*=f(g[0].y);y.xz*=f(g[0].x);float i=0.,x=0.;vec3 e=r;for(int z=0;z<199;++z){x=m(r);if(x<.001||i>200.)break;if(x<.05)x=.05;i+=x*.5;r+=y*x*.5;}vec3 z=vec3(0);if(x<.01)z=mix(vec3(1,0,0),l(r),1.-n(r.xz)),z*=exp(-i/50.);if(gl_FragCoord.x<1.&&gl_FragCoord.y<1.){float k=m(e+vec3(0,-2,0));vec3 d=s(e+vec3(0,-2,0));if(k<0.&&d.y>.99){vec3 c=d*k;gl_FragColor=vec4(-c.y,0,0,1);}else gl_FragColor=vec4(0);}else gl_FragColor=vec4(z,1);}',p=g.ch(35632),g.so(p,o),g.cS(p),g.ah(h,p),console.log(g.geL(p)),g.vto(g.lg(h),2,5120,g.eet(g.ur(h)),g.bf(o=34962,g.cu()),g.ba(o,Uint8Array.of(1,1,1,128,128,1),o+82)),b=[0,0,0,0,0,0,0,0],c=new Uint8Array(16),k=10,l=e=m=n=f=d=0,i={},a.onclick=o=>(a.requestPointerLock(),a.onclick=0,a.onmousemove=o=>(f+=.003*o.movementX,d-=.003*o.movementY)),document.onkeydown=o=>i[o.keyCode]=1,document.onkeyup=o=>i[o.keyCode]=0,A=o=>(l-=.02,k+=l,k<0&&(k=0,l=0,e=1),i[87]&&(m+=.4*Math.sin(f),n+=.4*Math.cos(f)),i[83]&&(m-=.4*Math.sin(f),n-=.4*Math.cos(f)),i[68]&&(m+=.4*Math.sin(f+Math.PI/2),n+=.4*Math.cos(f+Math.PI/2)),i[65]&&(m+=.4*Math.sin(f-Math.PI/2),n+=.4*Math.cos(f-Math.PI/2)),i[32]&&e&&(k+=(l=.5),e=0),b[0]=f,b[1]=d,b[4]=m,b[5]=k,b[6]=n,g.re(g.da(4,g.uniform4fv(g.goa(h,'g'),b),3),0,1,1,6408,g.UNSIGNED_BYTE,c),requestAnimationFrame(A)),A()">html,body{margin:0