<canvas id=a width=1024 height=768></canvas><style onload="g=a.getContext('webgl');for(f in g)g[f[0]+f[7]+[f[13]]]=g[f];i=g.cr(),p='attribute vec4 a;void main(){gl_Position=a;}',q=g.ch(35633),g.so(q,p),g.cS(q),g.ah(i,q),p='precision highp float;uniform vec4 g[2];float v(vec2 v){return fract(sin(dot(v,vec2(12.9,4.1)))*43.5);}vec3 n(float v){return.45+.51*(clamp(abs(mod(fract(v)*6.+vec3(0,4,2),6.)-3.)-1.,0.,1.)-.5);}mat2 r(float v){return mat2(cos(v),sin(v),-sin(v),cos(v));}vec4 n(vec3 f,int y){vec4 i=vec4(200);for(float x=-1.;x<=1.;x++){for(float z=-1.;z<=1.;z++){vec2 s=vec2(x,z)+floor((f.xz+10.)/20.);float m=v(s),c=6.3*v(vec2(m,4));vec3 d=f-vec3(s.x,-5.,s.y)*20.;d.xz*=r(c);float w=20.*v(vec2(m,2));vec3 e=abs(d)-vec3(5.+8.*v(vec2(m,1)),y==0?100.+w:f.y>w?0.:1000.,5.+8.*v(vec2(m,3)));d=floor(d);vec4 a=vec4((1.+.3*mod(d.x+d.y+d.z,2.))*n(v(vec2(m,5))),length(max(e,0.))+min(max(e.x,max(e.y,e.z)),0.));i=a.w<i.w?a:i;}}return i;}float f(vec3 v){float f=0.,s=0.;for(int x=0;x<99;++x){s=n(v,0).w;if(s<.001||f>100.)break;f+=s;v.y-=s;}return f;}vec3 f(vec3 v,int s){vec2 d=vec2(.001,0);return normalize(vec3(n(v+d.xyy,s).w-n(v-d.xyy,s).w,n(v+d.yxy,s).w-n(v-d.yxy,s).w,n(v+d.yyx,s).w-n(v-d.yyx,s).w));}vec2 s(float v){return v=(v+1.)/2.,vec2(floor(v*255.)/255.,fract(255.*v));}void main(){vec2 v=(gl_FragCoord.xy-.5*vec2(1024,768))/768.;vec3 d=g[1].xyz,i=normalize(vec3(v,1));float m=f(d);vec3 e=vec3(0);float x=n(d,1).w;if(m<3.)e.y=3.-m;if(x<3.)e.xz=(3.-x)*f(d,1).xz;if(gl_FragCoord.x<=2.&&gl_FragCoord.y<1.){gl_FragColor=gl_FragCoord.x<1.?vec4(s(e.x),s(e.y)):vec4(s(e.z),m<3.?1:0,0);return;}d+=e;d.y+=.2*(sin(d.x)+sin(d.z));i.yz*=r(g[0].y);i.xz*=r(g[0].x);float z=0.;vec4 c=vec4(0);for(int y=0;y<99;++y){c=n(d,0);if(c.w<.001||z>100.)break;z+=c.w*.9;d+=i*c.w*.9;}vec3 y=z<100.?mix(vec3(.3,.3,.5),c.xyz*(.5+.5*max(0.,dot(vec3(.6),f(d,0)))),exp(-z/40.)):vec3(.3,.3,.5);gl_FragColor=vec4(y,1);}',q=g.ch(35632),g.so(q,p),g.cS(q),g.ah(i,q),console.log(g.geL(q)),g.vto(g.lg(i),2,5120,g.eet(g.ur(i)),g.bf(p=34962,g.cu()),g.ba(p,Uint8Array.of(1,1,1,128,128,1),p+82)),b=[0,0,0,0,0,0,0,0],c=new Uint8Array(8),l=40,m=f=n=o=h=d=0,A={},a.onclick=p=>(a.requestPointerLock(),a.onclick=0,a.onmousemove=p=>(h+=.003*p.movementX,d-=.003*p.movementY)),e=p=>(c[p]/255+c[p+1]/255/255)*2-1,document.onkeydown=p=>A[p.keyCode]=1,document.onkeyup=p=>A[p.keyCode]=0,k=p=>(m-=.02,l+=m,A[87]&&(n+=.4*Math.sin(h),o+=.4*Math.cos(h)),A[83]&&(n-=.4*Math.sin(h),o-=.4*Math.cos(h)),A[68]&&(n+=.4*Math.sin(h+Math.PI/2),o+=.4*Math.cos(h+Math.PI/2)),A[65]&&(n+=.4*Math.sin(h-Math.PI/2),o+=.4*Math.cos(h-Math.PI/2)),A[32]&&f&&(l+=(m=.5),f=0),b[0]=h,b[1]=d,b[4]=n,b[5]=l,b[6]=o,g.re(g.da(4,g.uniform4fv(g.goa(i,'g'),b),3),0,2,1,6408,g.UNSIGNED_BYTE,c),console.log(n,l,o),n+=e(0),l+=e(2),o+=e(4),c[6]&&(m=0,f=1),requestAnimationFrame(k)),k()">html,body{margin:0