<canvas id=a width=320 height=200></canvas><h1 id=s></h1><style onload="g=a.getContext('webgl');for(f in g)g[f[0]+f[7]+[f[13]]]=g[f];A=g.cr(),t='attribute vec4 a;void main(){gl_Position=a;}',u=g.ch(35633),g.so(u,t),g.cS(u),g.ah(A,u),t='precision highp float;uniform vec4 g[2];int v;mat2 f(float v){return mat2(cos(v),sin(v),-sin(v),cos(v));}float x(vec2 v){return fract(sin(dot(v,vec2(12.9,4.1)))*43.5);}float f(vec3 v,vec3 m,vec3 f,float y){vec3 x=v-m,z=f-m;float r=clamp(dot(x,z)/dot(z,z),0.,1.);return length(x-z*r)-y;}vec4 m(vec3 m){vec4 r=vec4(200);for(float i=-1.;i<=1.;i++){for(float y=-1.;y<=1.;y++){vec2 z=vec2(i,y)+floor((m.xz+10.)/20.);vec3 d,s=m-vec3(z.x,-5.,z.y)*20.;s.xz*=f(6.3*x(vec2(x(z),4)));d=abs(s)-vec3(5.+8.*x(vec2(x(z),1)),z.y<-1.?0.:v==0?100.+20.*x(vec2(x(z),2))+5.*z.y:m.y>20.*x(vec2(x(z),2))+5.*z.y?0.:1000.,5.+8.*x(vec2(x(z),3)));s=floor(s);vec4 n=vec4((1.-.3*mod(s.x+s.y+s.z,2.))*(.45+.51*(clamp(abs(mod(fract(x(vec2(x(z),5)))*6.+vec3(0,4,2),6.)-3.)-1.,0.,1.)-.5)),length(max(d,0.))+min(max(d.x,max(d.y,d.z)),0.));r=n.w<r.w?n:r;}}return r;}vec3 n(vec3 v){vec2 r=vec2(.001,0);return normalize(vec3(m(v+r.xyy).w-m(v-r.xyy).w,m(v+r.yxy).w-m(v-r.yxy).w,m(v+r.yyx).w-m(v-r.yyx).w));}vec2 r(float v){return v=(v+1.)/2.,vec2(floor(v*255.)/255.,fract(v*255.));}void main(){if(g[0].w>0.){gl_FragColor=vec4(mix(3.*vec3(1,.25,.1),vec3(0),g[0].w/60.),1);return;}float i;vec4 z;vec2 x=(gl_FragCoord.xy-.5*vec2(320,200))/200.;vec3 y=g[1].xyz,d=vec3(0,-1,0);v=0;i=0.;z=vec4(0);for(int s=0;s<99;++s){z=m(y);if(z.w<.001||i>100.)break;i+=z.w*.9;y+=d*z.w*.9;}float s=i;y=g[1].xyz;d=normalize(vec3(x,1));v=1;vec3 c=vec3(0),e=y;float w=m(y-vec3(0,2,0)).w;if(s<3.)c.y=3.-s;if(w<2.)c.xz=(2.-w)*n(y-vec3(0,2,0)).xz;v=0;if(gl_FragCoord.x<=2.&&gl_FragCoord.y<1.){gl_FragColor=gl_FragCoord.x<1.?vec4(r(c.x),r(c.y)):vec4(r(c.z),s<3.?1:0,0);return;}y+=c;y.y+=.2*(sin(y.x)+sin(y.z));d.yz*=f(g[0].y);d.xz*=f(g[0].x);i=0.;z=vec4(0);for(int l=0;l<99;++l){z=m(y);if(z.w<.001||i>100.)break;i+=z.w*.9;y+=d*z.w*.9;}vec3 l=vec3(0);float a=-(e.y-g[0].z)/d.y;if(a>0.&&(a<i||i>100.))l=mix(vec3(0),3.*vec3(1,.25,.1),exp(-a/40.));else if(i<100.){float o=2.*clamp(1.-.1*(y.y-g[0].z),0.,1.);l=mix(vec3(0),z.xyz*(.5+.5*max(0.,dot(vec3(.6),n(y))))+o*vec3(1,.25,.1),exp(-i/40.));}l=mix(l,vec3(0),-g[0].w/30.);gl_FragColor=vec4(l,1);}',u=g.ch(35632),g.so(u,t),g.cS(u),g.ah(A,u),g.vto(g.lg(A),2,5120,g.eet(g.ur(A)),g.bf(t=34962,g.cu()),g.ba(t,Uint8Array.of(1,1,1,128,128,1),t+82)),k=t=>(b=[0,0,0,0,0,40,0,0],c=new Uint8Array(8),d=-30,p=q=r=n=o=h=i=e=0,l={}),a.onclick=t=>(a.requestPointerLock(),a.onclick=0,a.onmousemove=t=>d==0&&(i+=.003*t.movementX,e-=.003*t.movementY)),f=t=>(c[t]/255+c[t+1]/255/255)*2-1,document.onkeydown=t=>l[t.keyCode]=1,document.onkeyup=t=>l[t.keyCode]=0,m=t=>(d>180&&k(),q-=.02,b[5]+=q,p=r=0,l[87]&&(p+=Math.sin(i),r+=Math.cos(i)),l[83]&&(p-=Math.sin(i),r-=Math.cos(i)),l[68]&&(p+=Math.cos(i),r-=Math.sin(i)),l[65]&&(p-=Math.cos(i),r+=Math.sin(i)),l[32]&&h&&(b[5]+=(q=.5),h=0),p&&r&&(p/=Math.sqrt(r*r+p*p),r/=Math.sqrt(r*r+p*p)),n+=(p-n)/5,o+=(r-o)/5,b[4]+=.4*n,b[6]+=.4*o,b[0]=i,b[1]=e,b[2]+=0.05,b[5]<b[2]+1&&d++||(s.innerText=b[5]|0),d<0&&d++,b[3]=d,g.re(g.da(4,g.uniform4fv(g.goa(A,'g'),b),3),0,2,1,6408,g.UNSIGNED_BYTE,c),b[4]+=f(0),b[5]+=f(2),b[6]+=f(4),c[6]&&(q=0,h=1),requestAnimationFrame(m)),k(),m()">html,body,canvas{margin:0;font-family:monospace;width:960px;height:600px;image-rendering:pixelated;image-rendering:crisp-edges;}h1{color:#fff;position:absolute;left:20px;top:0