<canvas id=a width=320 height=200></canvas><h1 id=s></h1><style onload="g=a.getContext('webgl');for(f in g)g[f[0]+f[7]+[f[13]]]=g[f];l=g.cr(),w='attribute vec4 a;void main(){gl_Position=a;}',x=g.ch(35633),g.so(x,w),g.cS(x),g.ah(l,x),w='precision highp float;uniform vec4 g[3];int v,f;mat2 n(float v){return mat2(cos(v),sin(v),-sin(v),cos(v));}float x(vec2 v){return fract(sin(dot(v,vec2(12.9,4.1)))*43.5);}float n(vec3 v,vec3 m,vec3 n,float y){vec3 f=v-m,x=n-m;float z=clamp(dot(f,x)/dot(x,x),0.,1.);return length(f-x*z)-y;}vec4 m(vec3 m){vec4 r=vec4(200);for(float i=-1.;i<=1.;i++){for(float y=-1.;y<=1.;y++){vec2 z=vec2(i,y)+floor((m.xz+10.)/20.);vec3 d,s=m-vec3(z.x,-5.,z.y)*20.;s.xz*=n(6.3*x(vec2(x(z),4)));d=abs(s)-vec3(5.+8.*x(vec2(x(z),1)),z.y<-1.?0.:v==0?100.+20.*x(vec2(x(z),2))+5.*z.y:m.y>20.*x(vec2(x(z),2))+5.*z.y?0.:1000.,5.+8.*x(vec2(x(z),3)));s=floor(s);vec4 t=vec4((1.-.3*mod(s.x+s.y+s.z,2.))*(.45+.51*(clamp(abs(mod(fract(x(vec2(x(z),5)))*6.+vec3(0,4,2),6.)-3.)-1.,0.,1.)-.5)),length(max(d,0.))+min(max(d.x,max(d.y,d.z)),0.));r=t.w<r.w?t:r;}}vec4 z=f==1?vec4(1,1,1,length(m-g[2].xyz)-.5):vec4(0,0,0,10000);return r.w<z.w?r:z;}vec3 r(vec3 v){vec2 z=vec2(.001,0);return normalize(vec3(m(v+z.xyy).w-m(v-z.xyy).w,m(v+z.yxy).w-m(v-z.yxy).w,m(v+z.yyx).w-m(v-z.yyx).w));}vec2 t(float v){return v=(v+1.)/2.,vec2(floor(v*255.)/255.,fract(v*255.));}void main(){if(g[0].w>0.){gl_FragColor=vec4(mix(3.*vec3(1,.25,.1),vec3(0),g[0].w/60.),1);return;}float z;vec4 x;vec2 d=(gl_FragCoord.xy-.5*vec2(320,200))/200.;vec3 y=g[1].xyz,i=vec3(0,-1,0);f=0;v=0;z=0.;x=vec4(0);for(int s=0;s<99;++s){x=m(y);if(x.w<.001||z>100.)break;z+=x.w*.9;y+=i*x.w*.9;}float s=z;y=g[1].xyz;i=normalize(vec3(d,1));v=1;vec3 c=vec3(0),e=y;float w=m(y-vec3(0,2,0)).w;if(s<3.)c.y=3.-s;if(w<2.)c.xz=(2.-w)*r(y-vec3(0,2,0)).xz;v=0;if(gl_FragCoord.x<=2.&&gl_FragCoord.y<1.){gl_FragColor=gl_FragCoord.x<1.?vec4(t(c.x),t(c.y)):vec4(t(c.z),s<3.?1:0,0);return;}y+=c;y.y+=.2*(sin(y.x)+sin(y.z));i.yz*=n(g[0].y);i.xz*=n(g[0].x);f=1;z=0.;x=vec4(0);for(int l=0;l<99;++l){x=m(y);if(x.w<.001||z>100.)break;z+=x.w*.9;y+=i*x.w*.9;}vec3 l=vec3(0);float a=-(e.y-g[0].z)/i.y;if(a>0.&&(a<z||z>100.))l=mix(vec3(0),3.*vec3(1,.25,.1),exp(-a/40.));else if(z<100.){float o=2.*clamp(1.-.1*(y.y-g[0].z),0.,1.);l=mix(vec3(0),x.xyz*(.5+.5*max(0.,dot(vec3(.6),r(y))))+o*vec3(1,.25,.1),exp(-z/40.));}l=mix(l,vec3(0),-g[0].w/30.);gl_FragColor=vec4(l,1);}',x=g.ch(35632),g.so(x,w),g.cS(x),g.ah(l,x),g.vto(g.lg(l),2,5120,g.eet(g.ur(l)),g.bf(w=34962,g.cu()),g.ba(w,Uint8Array.of(1,1,1,128,128,1),w+82)),n=w=>(b=[0,0,0,0,0,40,0,0,0,0,0,0],c=new Uint8Array(8),e=-30,t=u=v=q=r=A=k=f=0,h=[],o={},d=0,m=JSON.parse(localStorage.getItem(0)||'[]')),a.onclick=w=>(a.requestPointerLock(),a.onclick=0,a.onmousemove=w=>e==0&&(k+=.003*w.movementX,f-=.003*w.movementY)),i=w=>(c[w]/255+c[w+1]/255/255)*2-1,document.onkeydown=w=>o[w.keyCode]=1,document.onkeyup=w=>o[w.keyCode]=0,p=w=>(e>180&&n(),u-=.02,b[5]+=u,t=v=0,o[87]&&(t+=Math.sin(k),v+=Math.cos(k)),o[83]&&(t-=Math.sin(k),v-=Math.cos(k)),o[68]&&(t+=Math.cos(k),v-=Math.sin(k)),o[65]&&(t-=Math.cos(k),v+=Math.sin(k)),o[32]&&A&&(b[5]+=(u=.5),A=0),t&&v&&(t/=Math.sqrt(v*v+t*t),v/=Math.sqrt(v*v+t*t)),q+=(t-q)/5,r+=(v-r)/5,b[4]+=.4*q,b[6]+=.4*r,b[0]=k,b[1]=f,b[2]+=0.05,d<m.length&&(console.log(m[d]),b[8]=m[d][0],b[9]=m[d][1],b[10]=m[d++][2]),b[5]<b[2]+1&&e++||(s.innerText=b[5]|0,h.push([b[4],b[5],b[6]])),e<0&&e++,b[3]=e,e==1&&localStorage.setItem(0,JSON.stringify(h)),g.re(g.da(4,g.uniform4fv(g.goa(l,'g'),b),3),0,2,1,6408,5121,c),b[4]+=i(0),b[5]+=i(2),b[6]+=i(4),c[6]&&(u=0,A=1),requestAnimationFrame(p)),n(),p()">html,body,canvas{margin:0;font-family:monospace;width:960px;height:600px;image-rendering:pixelated;image-rendering:crisp-edges;}h1{color:#fff;position:absolute;left:20px;top:0