<canvas id=a width=1024 height=768></canvas><style onload="g=a.getContext('webgl');for(f in g)g[f[0]+f[7]+[f[13]]]=g[f];h=g.cr(),o='attribute vec4 a;void main(){gl_Position=a;}',p=g.ch(35633),g.so(p,o),g.cS(p),g.ah(h,p),o='precision highp float;uniform vec4 g[2];const float y=20.;float v(vec2 v){return fract(sin(dot(v,vec2(12.9,4.1)))*43.5);}mat2 n(float v){float y=cos(v),r=sin(v);return mat2(y,r,-r,y);}float n(vec3 v,vec3 y){vec3 r=abs(v)-y;return length(max(r,0.))+min(max(r.x,max(r.y,r.z)),0.);}vec2 f(vec3 v){return vec2(floor((v.x+.5*y)/y),floor((v.z+.5*y)/y));}float f(vec2 r,vec3 f){float m=v(r);f-=vec3(r.x,0,r.y)*y;f.xz*=n(100.*v(vec2(m,4.)));return n(f,vec3(5.+8.*v(vec2(m,1.)),100.+20.*v(vec2(m,2.)),5.+8.*v(vec2(m,3.))));}float r(vec3 v){v.y+=100.;float r=200.;for(float m=-1.;m<=1.;m++){for(float y=-1.;y<=1.;y++){vec2 n=f(v)+vec2(m,y);r=min(r,f(n,v));}}return r;}vec3 e(vec3 v){return v=floor(v),vec3(.5+.5*mod(v.x+v.y+v.z,2.));}vec3 m(vec3 v){vec2 y=vec2(.001,0);return normalize(vec3(r(v+y.xyy)-r(v-y.xyy),r(v+y.yxy)-r(v-y.yxy),r(v+y.yyx)-r(v-y.yyx)));}vec3 t(vec3 v){return v=floor(v),vec3(.5+.5*mod(v.x+v.y+v.z,2.));}void main(){vec2 v=(gl_FragCoord.xy-.5*vec2(1024,768))/768.;vec3 y=g[1].xyz,f=normalize(vec3(v,1));y.y+=.2*(sin(y.x)+sin(y.z));f.yz*=n(g[0].y);f.xz*=n(g[0].x);float i=0.,z=0.;vec3 x=y;for(int e=0;e<99;++e){z=r(y);if(z<.001||i>100.)break;i+=z*.9;y+=f*z*.9;}vec3 e=vec3(0);if(z<.01)e=t(y),e*=exp(-i/30.)*(.5+.5*clamp(dot(normalize(vec3(1,1,1)),m(y)),0.,1.));if(gl_FragCoord.x<1.&&gl_FragCoord.y<1.){float s=r(x+vec3(0,-3,0));vec3 d=m(x+vec3(0,-3,0));if(s<0.&&d.y>.99){vec3 l=d*s;gl_FragColor=vec4(-l.y,0,0,1);}else gl_FragColor=vec4(0);}else gl_FragColor=vec4(e,1);}',p=g.ch(35632),g.so(p,o),g.cS(p),g.ah(h,p),console.log(g.geL(p)),g.vto(g.lg(h),2,5120,g.eet(g.ur(h)),g.bf(o=34962,g.cu()),g.ba(o,Uint8Array.of(1,1,1,128,128,1),o+82)),b=[0,0,0,0,0,0,0,0],c=new Uint8Array(16),k=40,l=e=m=n=f=d=0,i={},a.onclick=o=>(a.requestPointerLock(),a.onclick=0,a.onmousemove=o=>(f+=.003*o.movementX,d-=.003*o.movementY)),document.onkeydown=o=>i[o.keyCode]=1,document.onkeyup=o=>i[o.keyCode]=0,A=o=>(l-=.02,k+=l,i[87]&&(m+=.4*Math.sin(f),n+=.4*Math.cos(f)),i[83]&&(m-=.4*Math.sin(f),n-=.4*Math.cos(f)),i[68]&&(m+=.4*Math.sin(f+Math.PI/2),n+=.4*Math.cos(f+Math.PI/2)),i[65]&&(m+=.4*Math.sin(f-Math.PI/2),n+=.4*Math.cos(f-Math.PI/2)),i[32]&&e&&(k+=(l=.5),e=0),b[0]=f,b[1]=d,b[4]=m,b[5]=k,b[6]=n,g.re(g.da(4,g.uniform4fv(g.goa(h,'g'),b),3),0,1,1,6408,g.UNSIGNED_BYTE,c),c[3]&&(k+=c[0]/255,l=0,e=1),requestAnimationFrame(A)),A()">html,body{margin:0