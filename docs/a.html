<canvas id=a width=1024 height=768></canvas><style onload="g=a.getContext('webgl');for(f in g)g[f[0]+f[7]+[f[13]]]=g[f];i=g.cr(),p='attribute vec4 a;void main(){gl_Position=a;}',q=g.ch(35633),g.so(q,p),g.cS(q),g.ah(i,q),p='precision highp float;uniform vec4 g[2];float v(vec2 v){return fract(sin(dot(v,vec2(12.9,4.1)))*43.5);}vec3 n(float v){return.45+.51*(clamp(abs(mod(fract(v)*6.+vec3(0,4,2),6.)-3.)-1.,0.,1.)-.5);}mat2 r(float v){return mat2(cos(v),sin(v),-sin(v),cos(v));}vec4 n(vec3 f,int y){vec4 i=vec4(200);for(float x=-1.;x<=1.;x++){for(float z=-1.;z<=1.;z++){vec2 m=vec2(x,z)+floor((f.xz+10.)/20.);float c=v(m),s=6.3*v(vec2(c,4));vec3 d=f-vec3(m.x,-5.,m.y)*20.;d.xz*=r(s);float w=20.*v(vec2(c,2));vec3 e=abs(d)-vec3(5.+8.*v(vec2(c,1)),y==0?100.+w:f.y>w?0.:1000.,5.+8.*v(vec2(c,3)));d=floor(d);vec4 a=vec4((1.+.3*mod(d.x+d.y+d.z,2.))*n(v(vec2(c,5))),length(max(e,0.))+min(max(e.x,max(e.y,e.z)),0.));i=a.w<i.w?a:i;}}return i;}vec3 r(vec3 v,int y){vec2 d=vec2(.001,0);return normalize(vec3(n(v+d.xyy,y).w-n(v-d.xyy,y).w,n(v+d.yxy,y).w-n(v-d.yxy,y).w,n(v+d.yyx,y).w-n(v-d.yyx,y).w));}vec2 f(float v){return v=(v+1.)/2.,vec2(floor(v*255.)/255.,fract(255.*v));}void main(){float v;vec4 d;vec2 c=(gl_FragCoord.xy-.5*vec2(1024,768))/768.;vec3 i=g[1].xyz,y=vec3(0,-1,0);v=0.;d=vec4(0);for(int x=0;x<99;++x){d=n(i,0);if(d.w<.001||v>100.)break;v+=d.w*.9;i+=y*d.w*.9;}float m=v;i=g[1].xyz;y=normalize(vec3(c,1));vec3 e=vec3(0);float x=n(i-vec3(0,2,0),1).w;if(m<3.)e.y=3.-m;if(x<2.)e.xz=(2.-x)*r(i-vec3(0,2,0),1).xz;if(gl_FragCoord.x<=2.&&gl_FragCoord.y<1.){gl_FragColor=gl_FragCoord.x<1.?vec4(f(e.x),f(e.y)):vec4(f(e.z),m<3.?1:0,0);return;}i+=e;i.y+=.2*(sin(i.x)+sin(i.z));y.yz*=r(g[0].y);y.xz*=r(g[0].x);v=0.;d=vec4(0);for(int z=0;z<99;++z){d=n(i,0);if(d.w<.001||v>100.)break;v+=d.w*.9;i+=y*d.w*.9;}vec3 z=v<100.?mix(vec3(.3,.3,.5),d.xyz*(.5+.5*max(0.,dot(vec3(.6),r(i,0)))),exp(-v/40.)):vec3(.3,.3,.5);gl_FragColor=vec4(z,1);}',q=g.ch(35632),g.so(q,p),g.cS(q),g.ah(i,q),g.vto(g.lg(i),2,5120,g.eet(g.ur(i)),g.bf(p=34962,g.cu()),g.ba(p,Uint8Array.of(1,1,1,128,128,1),p+82)),b=[0,0,0,0,0,0,0,0],c=new Uint8Array(8),l=40,m=f=n=o=h=d=0,A={},a.onclick=p=>(a.requestPointerLock(),a.onclick=0,a.onmousemove=p=>(h+=.003*p.movementX,d-=.003*p.movementY)),e=p=>(c[p]/255+c[p+1]/255/255)*2-1,document.onkeydown=p=>A[p.keyCode]=1,document.onkeyup=p=>A[p.keyCode]=0,k=p=>(m-=.02,l+=m,A[87]&&(n+=.4*Math.sin(h),o+=.4*Math.cos(h)),A[83]&&(n-=.4*Math.sin(h),o-=.4*Math.cos(h)),A[68]&&(n+=.4*Math.sin(h+Math.PI/2),o+=.4*Math.cos(h+Math.PI/2)),A[65]&&(n+=.4*Math.sin(h-Math.PI/2),o+=.4*Math.cos(h-Math.PI/2)),A[32]&&f&&(l+=(m=.5),f=0),b[0]=h,b[1]=d,b[4]=n,b[5]=l,b[6]=o,g.re(g.da(4,g.uniform4fv(g.goa(i,'g'),b),3),0,2,1,6408,g.UNSIGNED_BYTE,c),n+=e(0),l+=e(2),o+=e(4),c[6]&&(m=0,f=1),requestAnimationFrame(k)),k()">html,body{margin:0