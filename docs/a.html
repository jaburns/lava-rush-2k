<canvas id=a width=1024 height=768></canvas><style onload="g=a.getContext('webgl');for(f in g)g[f[0]+f[7]+[f[13]]]=g[f];i=g.cr(),m='attribute vec4 a;void main(){gl_Position=a;}',n=g.ch(35633),g.so(n,m),g.cS(n),g.ah(i,n),m='precision highp float;uniform vec4 g[2];int v;mat2 f(float v){return mat2(cos(v),sin(v),-sin(v),cos(v));}float n(vec2 v){return fract(sin(dot(v,vec2(12.9,4.1)))*43.5);}float f(vec3 v,vec3 m,vec3 f,float y){vec3 n=v-m,z=f-m;float x=clamp(dot(n,z)/dot(z,z),0.,1.);return length(n-z*x)-y;}vec4 m(vec3 m){vec4 i=vec4(200);for(float y=-1.;y<=1.;y++){for(float z=-1.;z<=1.;z++){vec2 x=vec2(y,z)+floor((m.xz+10.)/20.);vec3 r,d=m-vec3(x.x,-5.,x.y)*20.;d.xz*=f(6.3*n(vec2(n(x),4)));r=abs(d)-vec3(5.+8.*n(vec2(n(x),1)),x.y<-1.?0.:v==0?100.+20.*n(vec2(n(x),2))+5.*x.y:m.y>20.*n(vec2(n(x),2))+5.*x.y?0.:1000.,5.+8.*n(vec2(n(x),3)));d=floor(d);vec4 t=vec4((1.+.3*mod(d.x+d.y+d.z,2.))*(.45+.51*(clamp(abs(mod(fract(n(vec2(n(x),5)))*6.+vec3(0,4,2),6.)-3.)-1.,0.,1.)-.5)),length(max(r,0.))+min(max(r.x,max(r.y,r.z)),0.));i=t.w<i.w?t:i;}}return i;}vec3 r(vec3 v){vec2 d=vec2(.001,0);return normalize(vec3(m(v+d.xyy).w-m(v-d.xyy).w,m(v+d.yxy).w-m(v-d.yxy).w,m(v+d.yyx).w-m(v-d.yyx).w));}vec2 t(float v){return v=(v+1.)/2.,vec2(floor(v*255.)/255.,fract(v*255.));}void main(){float i;vec4 d;vec2 n=(gl_FragCoord.xy-.5*vec2(1024,768))/768.;vec3 x=g[1].xyz,z=vec3(0,-1,0);v=0;i=0.;d=vec4(0);for(int y=0;y<99;++y){d=m(x);if(d.w<.001||i>100.)break;i+=d.w*.9;x+=z*d.w*.9;}float y=i;x=g[1].xyz;z=normalize(vec3(n,1));v=1;vec3 c=vec3(0),s=x;float w=m(x-vec3(0,2,0)).w;if(y<3.)c.y=3.-y;if(w<2.)c.xz=(2.-w)*r(x-vec3(0,2,0)).xz;v=0;if(gl_FragCoord.x<=2.&&gl_FragCoord.y<1.){gl_FragColor=gl_FragCoord.x<1.?vec4(t(c.x),t(c.y)):vec4(t(c.z),y<3.?1:0,0);return;}x+=c;x.y+=.2*(sin(x.x)+sin(x.z));z.yz*=f(g[0].y);z.xz*=f(g[0].x);i=0.;d=vec4(0);for(int e=0;e<99;++e){d=m(x);if(d.w<.001||i>100.)break;i+=d.w*.9;x+=z*d.w*.9;}vec3 e=vec3(0);float a=-(s.y-g[0].z)/z.y;if(a>0.&&(a<i||i>100.))e=mix(vec3(0),3.*vec3(1,.25,0),exp(-a/40.));else if(i<100.){float l=2.*clamp(1.-.1*(x.y-g[0].z),0.,1.);e=mix(vec3(0),d.xyz*(.5+.5*max(0.,dot(vec3(.6),r(x))))+l*vec3(1,.25,0),exp(-i/40.));}gl_FragColor=vec4(e,1);}',n=g.ch(35632),g.so(n,m),g.cS(n),g.ah(i,n),console.log(g.geL(n)),g.vto(g.lg(i),2,5120,g.eet(g.ur(i)),g.bf(m=34962,g.cu()),g.ba(m,Uint8Array.of(1,1,1,128,128,1),m+82)),b=[0,0,0,0,0,40,0,0],c=new Uint8Array(8),l=f=h=d=0,A={},a.onclick=m=>(a.requestPointerLock(),a.onclick=0,a.onmousemove=m=>(h+=.003*m.movementX,d-=.003*m.movementY)),e=m=>(c[m]/255+c[m+1]/255/255)*2-1,document.onkeydown=m=>A[m.keyCode]=1,document.onkeyup=m=>A[m.keyCode]=0,k=m=>(l-=.02,b[5]+=l,A[87]&&(b[4]+=.4*Math.sin(h),b[6]+=.4*Math.cos(h)),A[83]&&(b[4]-=.4*Math.sin(h),b[6]-=.4*Math.cos(h)),A[68]&&(b[4]+=.4*Math.cos(h),b[6]-=.4*Math.sin(h)),A[65]&&(b[4]-=.4*Math.cos(h),b[6]+=.4*Math.sin(h)),A[32]&&f&&(b[5]+=(l=.5),f=0),b[0]=h,b[1]=d,b[2]+=0.05,b[5]<b[2]+.2&&location.reload(),g.re(g.da(4,g.uniform4fv(g.goa(i,'g'),b),3),0,2,1,6408,g.UNSIGNED_BYTE,c),b[4]+=e(0),b[5]+=e(2),b[6]+=e(4),c[6]&&(l=0,f=1),requestAnimationFrame(k)),k()">html,body{margin:0