<canvas id=a width=1024 height=768></canvas><style onload="g=a.getContext('webgl');for(f in g)g[f[0]+f[7]+[f[13]]]=g[f];h=g.cr(),o='attribute vec4 a;void main(){gl_Position=a;}',p=g.ch(35633),g.so(p,o),g.cS(p),g.ah(h,p),o='precision highp float;uniform vec4 g[2];float v(vec2 v){return fract(sin(dot(v,vec2(12.9,4.1)))*43.5);}vec3 n(float v){return.45+.51*(clamp(abs(mod(fract(v)*6.+vec3(0,4,2),6.)-3.)-1.,0.,1.)-.5);}mat2 r(float v){return mat2(cos(v),sin(v),-sin(v),cos(v));}vec4 f(vec3 f){f.y+=100.;vec4 i=vec4(200);for(float y=-1.;y<=1.;y++){for(float x=-1.;x<=1.;x++){vec2 m=vec2(y,x)+floor((f.xz+10.)/20.);float c=v(m),s=6.3*v(vec2(c,4));vec3 d=f-vec3(m.x,0,m.y)*20.;d.xz*=r(s);vec3 w=abs(d)-vec3(5.+8.*v(vec2(c,1)),100.+20.*v(vec2(c,2)),5.+8.*v(vec2(c,3)));d=floor(d);vec4 a=vec4((1.+.3*mod(d.x+d.y+d.z,2.))*n(v(vec2(c,5))),length(max(w,0.))+min(max(w.x,max(w.y,w.z)),0.));i=a.w<i.w?a:i;}}return i;}vec3 x(vec3 v){vec2 d=vec2(.001,0);return normalize(vec3(f(v+d.xyy).w-f(v-d.xyy).w,f(v+d.yxy).w-f(v-d.yxy).w,f(v+d.yyx).w-f(v-d.yyx).w));}void main(){vec2 v=(gl_FragCoord.xy-.5*vec2(1024,768))/768.;vec3 d=g[1].xyz,c=d,i=normalize(vec3(v,1));d.y+=.2*(sin(d.x)+sin(d.z));i.yz*=r(g[0].y);i.xz*=r(g[0].x);float y=0.;vec4 m=vec4(0);for(int w=0;w<99;++w){m=f(d);if(m.w<.001||y>100.)break;y+=m.w*.9;d+=i*m.w*.9;}vec3 w=y<100.?mix(vec3(.3,.3,.5),m.xyz*(.5+.5*max(0.,dot(vec3(.6),x(d)))),exp(-y/40.)):vec3(.3,.3,.5);if(gl_FragCoord.x<1.&&gl_FragCoord.y<1.){float s=f(c+vec3(0,-3,0)).w;vec3 a=x(c+vec3(0,-3,0));if(s<0.&&a.y>.99){vec3 n=a*s;gl_FragColor=vec4(-n.y,0,0,1);}else gl_FragColor=vec4(0);}else gl_FragColor=vec4(w,1);}',p=g.ch(35632),g.so(p,o),g.cS(p),g.ah(h,p),console.log(g.geL(p)),g.vto(g.lg(h),2,5120,g.eet(g.ur(h)),g.bf(o=34962,g.cu()),g.ba(o,Uint8Array.of(1,1,1,128,128,1),o+82)),b=[0,0,0,0,0,0,0,0],c=new Uint8Array(16),k=40,S=Math.sin,C=Math.cos,l=e=m=n=f=d=0,i={},a.onclick=o=>(a.requestPointerLock(),a.onclick=0,a.onmousemove=o=>(f+=.003*o.movementX,d-=.003*o.movementY)),document.onkeydown=o=>i[o.keyCode]=1,document.onkeyup=o=>i[o.keyCode]=0,A=o=>(l-=.02,k+=l,i[87]&&(m+=.4*S(f),n+=.4*C(f)),i[83]&&(m-=.4*S(f),n-=.4*C(f)),i[68]&&(m+=.4*S(f+Math.PI/2),n+=.4*C(f+Math.PI/2)),i[65]&&(m+=.4*S(f-Math.PI/2),n+=.4*C(f-Math.PI/2)),i[32]&&e&&(k+=(l=.5),e=0),b[0]=f,b[1]=d,b[4]=m,b[5]=k,b[6]=n,g.re(g.da(4,g.uniform4fv(g.goa(h,'g'),b),3),0,1,1,6408,g.UNSIGNED_BYTE,c),c[3]&&(k+=c[0]/255,l=0,e=1),requestAnimationFrame(A)),A()">html,body{margin:0